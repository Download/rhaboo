<script src = '../other-peoples/localforage.js'></script>
<script>

//ResultFirefox:120
//ResultChrome:50
//ResultIE:1.900
//ResultUnits:ms/write
//ResultFootnote:*Falls back to localStorage

var reps=50;

var whenStarted, whenStopped;

var i=-1;

function iter() {
  if (i==reps-1) {
    i--;
    whenStopped = performance.now();
    localforage.getItem("Foo" + i%10).then(function(v) {
      if (v==i)
        document.getElementById('result').innerHTML = ""+((whenStopped-whenStarted)/reps) + " ms/write" ;
      else 
        document.getElementById('result').innerHTML = "Failed"+JSON.stringify(v);
    })
  }
  else {
    i++;
    localforage.setItem("Foo" + i%10, i).then(function() { iter(); });
  }
}

function go() {
  var d_id = localforage.supports('asyncStorage');
  var d_ws = localforage.supports('webSQLStorage');
  var d_ls = localforage.supports('localStorageWrapper');
  document.getElementById('drivers').innerHTML=("Supports: indexedDB:"+d_id + ", webSQL:" + d_ws +", localStorage:" + d_ls);
  localforage.clear(function() {
    whenStarted = performance.now();
    iter();
  });
}
</script>
<body onLoad='go()'>
  <h3>Write one of 10 integers 50 times over with localForage</h3>
  <p>This is not using arrays (rhaboo's forte.) Each integer is a separate entry.
  <div id='drivers'></div>
  <p>Test took <span id='result'>...</span></p>
  <p><a href='index.htm'>Performance tests overview</a>
</body>

