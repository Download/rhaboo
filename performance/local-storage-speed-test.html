<!DOCTYPE html>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<html>
  <link rel="stylesheet" type="text/css" href="sty.css">
  <script>

var string1024="0123456789ABCDEF";
string1024 = string1024 + string1024 + string1024 + string1024 + string1024 + string1024 + string1024 + string1024 ;
string1024 = string1024 + string1024 + string1024 + string1024 + string1024 + string1024 + string1024 + string1024 ;

var theLog;

function log(msg) {
  theLog.innerHTML += msg+"\n";
}

function clear_storage() {
  for (var i in localStorage) 
    localStorage.removeItem(i);
  log("Cleared local storage");
}

function stuff_many_small() {
  var whenStarted, whenStopped;
  whenStarted = performance.now();
  for (var i=0;i<4*1024;i++)
    localStorage[i] = string1024;
  whenStopped = performance.now();
  log("Stuffed in " + String(whenStopped-whenStarted)+ " ms")
}

function check_many_small() {
  var ok=true;
  var whenStarted, whenStopped;
  whenStarted = performance.now();
  for (var i=0;i<4*1024;i++)
    if (localStorage[i] != string1024) {
      ok = false;
      break;
    }
  whenStopped = performance.now();
  log((ok ? "Right: " : "Wrong: ")+"Checked in "+String(whenStopped-whenStarted)+" ms");
}

function go() {
  theLog = document.getElementById('log');
  log("Initial render duraion: "+String(performance.timing.domComplete-performance.timing.responseEnd)+" ms");
}

  </script>

  <body onLoad="go();">
    <table width='100%'> <tr> <td width='50%'>
      <h2>Testing localStorage performance</h3>
      <p>This page lets you clear localStorage or populate it with 4096 strings of 1024 characters each.
      <p>You can see the inital render time which is: <pre>  (performance.timing.domComplete - performance.timing.responseEnd)</pre>
      <p>The check button examines all 4096 entries to make sure they contain the expected string.
      <p>It's worth doing these tests using two browsers or even two computers to rule out memory or disk cache effects.
      <p>Results: considerable random variation in the timings but no discernable dependency on whether localStorage is populated or not.
    </td> <td width='15%'>
      <span class='button' onClick='clear_storage();'>Clear</span>
      <span class='button' onClick='stuff_many_small();'>Stuff</span>
      <span class='button' onClick='check_many_small();'>Check</span>
    </td> <td width='35%'>
      <pre id='log'></pre>
    </td> </tr> </table>
  <p><a href='index.htm'>Performance tests overview</a>
  </body>
</html>
