/*! rhaboo 2014-08-12 */
"use strict";function Rhaboo(a){this._rhaboo_restore(a)}function emptyPromise(){var a=new Q.defer;return a.resolve(),a.promise}function _handle_business(){if(!_business_callback)return 0;var a=_enq_head.isPending();return a&&(_business_promise=_enq_head.then(_handle_business)),a!=_business_reported&&(_business_reported=a?!0:!1,_business_callback&&_business_callback(_business_reported)),0}function enqOnBusiness(a){_business_callback=a}function enq(a){var b=function(){var b=Q.defer();return a(b),b.promise};_enq_head=_enq_head.then(b),_handle_business()}Array.prototype._rhaboo_originals=Array.prototype._rhaboo_originals||{pop:Array.prototype.pop,push:Array.prototype.push,shift:Array.prototype.shift,unshift:Array.prototype.unshift,splice:Array.prototype.splice,reverse:Array.prototype.reverse,sort:Array.prototype.sort},Array.prototype._rhaboo_defensively=function(a){return function(){var b;void 0!==this._rhaboo&&(b=this.slice(),b._rhaboo=this._rhaboo);var c=Array.prototype._rhaboo_originals[a].apply(this,arguments);return void 0!==this._rhaboo&&this._rhaboo.parent._rhaboo_persist(this._rhaboo.where,this,b),c}},Array.prototype.push=function(){var a=this.length,b=(Array.prototype._rhaboo_originals.push.apply(this,arguments),this.length);if(void 0!==this._rhaboo&&b>a)for(var c=a;b>c;c++){var d=this._rhaboo_childKey(c);enq(function(a){_rhaboo_stashers[_rhaboo_getTypeOf(this[c])](c,d,this[c],this),a.resolve()})}},Array.prototype.pop=function(){var a=this.length,b=Array.prototype._rhaboo_originals.pop.apply(this,arguments);if(void 0!==this._rhaboo&&a>0){var c=this._rhaboo_childKey(a-1);enq(function(a){_rhaboo_forgetters[_rhaboo_getTypeOf(b)](c,b),a.resolve()})}return b},Array.prototype.shift=Array.prototype._rhaboo_defensively("shift"),Array.prototype.unshift=Array.prototype._rhaboo_defensively("unshift"),Array.prototype.splice=Array.prototype._rhaboo_defensively("splice"),Array.prototype.reverse=Array.prototype._rhaboo_defensively("reverse"),Array.prototype.sort=Array.prototype._rhaboo_defensively("sort");var _rhaboo_trace=function(){},_rhaboo_store=localStorage,_rhaboo_store_setItem=function(a,b){return _rhaboo_trace("STORE: setting "+a+" = "+b),_rhaboo_store.setItem(a,b)},_rhaboo_store_getItem=function(a){var b=_rhaboo_store.getItem(a);return _rhaboo_trace("STORE: getting "+a+" = "+b),b},_rhaboo_store_removeItem=function(a){return _rhaboo_trace("STORE: killing "+a),_rhaboo_store.removeItem(a)};Object.prototype._rhaboo_classcode="&",Array.prototype._rhaboo_classcode="#",Object.prototype._rhaboo_childKey=function(a){return this._rhaboo.key+this._rhaboo_classcode+"|"+String(a)},Object.prototype.write=function(a,b){var c=this[a];return this[a]=b,this._rhaboo_persist(a,b,c),this},Object.prototype._rhaboo_persist=function(a,b,c){if(void 0!==this._rhaboo){var d=this._rhaboo_childKey(a);enq(function(e){_rhaboo_forgetters[_rhaboo_getTypeOf(c)](d,c),_rhaboo_stashers[_rhaboo_getTypeOf(b)](a,d,b,this),e.resolve()})}};var _rhaboo_stashers={nothing:function(){},leaf:function(a,b,c){_rhaboo_store_setItem(b,typeof c+"|"+String(c))},object:function(a,b,c,d){c._rhaboo_stash(a,b,d)},bad:function(){}},_rhaboo_forgetters={nothing:function(){},leaf:function(a){_rhaboo_store_removeItem(a)},object:function(a,b){b._rhaboo_forget()},bad:function(){}};Object.prototype._rhaboo_stash=function(a,b,c){this._rhaboo=this._rhaboo||{},this._rhaboo.key=b,this._rhaboo.parent=c,this._rhaboo.where=a,_rhaboo_store_setItem(this._rhaboo_childKey(""),"|");for(var a in this)if("_rhaboo"!==a&&this.hasOwnProperty(a)){var d=this[a];_rhaboo_stashers[_rhaboo_getTypeOf(d)](a,this._rhaboo_childKey(a),d,this)}},Object.prototype._rhaboo_forget=function(){if(void 0!==this._rhaboo&&void 0!==this._rhaboo.key){for(var a in this)if("_rhaboo"!==a&&this.hasOwnProperty(a)){var b=this[a];_rhaboo_forgetters[_rhaboo_getTypeOf(b)](this._rhaboo_childKey(a),b)}_rhaboo_store_removeItem(this._rhaboo_childKey(""))}},Object.prototype._rhaboo_restore=function(a){this._rhaboo=this._rhaboo||{},this._rhaboo.key=a;for(var b in _rhaboo_store)if(_rhaboo_store.hasOwnProperty(b)){var c=b.split("|");if(c.shift()===a+this._rhaboo_classcode){for(var d=this;c.length>1;){var e=c.shift(),f=e.slice(0,length-1);void 0===d[f]&&(d[f]=e.charAt(e.length-1)===Array.prototype._rhaboo_classcode?[]:{},d[f]._rhaboo=d[f]._rhaboo||{},d[f]._rhaboo.key=d._rhaboo_childKey(f),d[f]._rhaboo.parent=d,d[f]._rhaboo.where=f),d=d[f]}var g=c.shift();if(""!==g){var h=_rhaboo_store_getItem(b).split("|");d[g]={number:function(a){return Number(a)},string:function(a){return a},"boolean":function(a){return"true"===a?!0:!1}}[h[0]](h[1])}}}};var _rhaboo_getTypeOf=function(a){if(null===a||void 0===a)return"nothing";var b=typeof a;return"string"===b||"number"===b||"boolean"===b?"leaf":"object"===b?"object":"bad"},_rhaboo_getClassOf=function(a){var b=_rhaboo_getTypeOf(a);return"object"===b?a._rhaboo_isArray()?"array":"object":b};Object.prototype._rhaboo_isArray=function(){return"number"==typeof this.length&&"function"==typeof this.splice&&!this.propertyIsEnumerable("length")},Object.prototype._rhaboo_size=function(){var a=0;for(var b in this)this.hasOwnProperty(b)&&a++;return a};var _enq_head=emptyPromise(),_business_promise=void 0,_business_callback=void 0,_business_reported=!1;